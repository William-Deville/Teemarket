{"version":3,"sources":["../../../src/server/middleware/auth.middleware.js"],"names":["jwt","require","UserModel","module","exports","checkUser","req","res","next","token","cookies","verify","process","env","TOKEN_SECRET","err","decodedToken","locals","user","cookie","maxAge","findById","id","requireAuth","console","log","send","json"],"mappings":"AAAA,MAAMA,GAAG,GAAGC,OAAO,CAAC,cAAD,CAAnB;;AACA,MAAMC,SAAS,GAAGD,OAAO,CAAC,sBAAD,CAAzB;;AAEAE,MAAM,CAACC,OAAP,CAAeC,SAAf,GAA2B,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC3C,QAAMC,KAAK,GAAGH,GAAG,CAACI,OAAJ,CAAYV,GAA1B;;AACA,MAAGS,KAAH,EAAU;AACNT,IAAAA,GAAG,CAACW,MAAJ,CAAWF,KAAX,EAAkBG,OAAO,CAACC,GAAR,CAAYC,YAA9B,EAA4C,OAAOC,GAAP,EAAYC,YAAZ,KAA6B;AACrE,UAAGD,GAAH,EAAQ;AACJR,QAAAA,GAAG,CAACU,MAAJ,CAAWC,IAAX,GAAkB,IAAlB;AACAX,QAAAA,GAAG,CAACY,MAAJ,CAAW,KAAX,EAAkB,EAAlB,EAAsB;AAAEC,UAAAA,MAAM,EAAE;AAAV,SAAtB;AACAZ,QAAAA,IAAI;AACP,OAJD,MAIO;AACH,YAAIU,IAAI,GAAG,MAAMhB,SAAS,CAACmB,QAAV,CAAmBL,YAAY,CAACM,EAAhC,CAAjB;AACAf,QAAAA,GAAG,CAACU,MAAJ,CAAWC,IAAX,GAAkBA,IAAlB,CAFG,CAGH;;AACAV,QAAAA,IAAI;AACP;AACJ,KAXD;AAYH,GAbD,MAaO;AACHD,IAAAA,GAAG,CAACU,MAAJ,CAAWC,IAAX,GAAkB,IAAlB;AACAV,IAAAA,IAAI;AACP;AACJ,CAnBD;;AAqBAL,MAAM,CAACC,OAAP,CAAemB,WAAf,GAA6B,CAACjB,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC7C,QAAMC,KAAK,GAAGH,GAAG,CAACI,OAAJ,CAAYV,GAA1B;;AACA,MAAGS,KAAH,EAAU;AACNT,IAAAA,GAAG,CAACW,MAAJ,CAAWF,KAAX,EAAkBG,OAAO,CAACC,GAAR,CAAYC,YAA9B,EAA4C,OAAOC,GAAP,EAAYC,YAAZ,KAA6B;AACrE,UAAGD,GAAH,EAAQ;AACJS,QAAAA,OAAO,CAACC,GAAR,CAAYV,GAAZ;AACAR,QAAAA,GAAG,CAACmB,IAAJ,CAAS,GAAT,EAAcC,IAAd,CAAmB,UAAnB;AACH,OAHD,MAGO;AACHH,QAAAA,OAAO,CAACC,GAAR,CAAYT,YAAY,CAACM,EAAzB;AACAd,QAAAA,IAAI;AACP;AACJ,KARD;AASH,GAVD,MAUO;AACHgB,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACH;AACJ,CAfD","sourcesContent":["const jwt = require('jsonwebtoken');\r\nconst UserModel = require('../models/user.model');\r\n\r\nmodule.exports.checkUser = (req, res, next) => {\r\n    const token = req.cookies.jwt;\r\n    if(token) {\r\n        jwt.verify(token, process.env.TOKEN_SECRET, async (err, decodedToken) => {\r\n            if(err) {\r\n                res.locals.user = null;\r\n                res.cookie('jwt', '', { maxAge: 1 });\r\n                next();\r\n            } else {\r\n                let user = await UserModel.findById(decodedToken.id);\r\n                res.locals.user = user;\r\n                //console.log(user);\r\n                next();\r\n            }\r\n        })\r\n    } else {\r\n        res.locals.user = null;\r\n        next();\r\n    }\r\n};\r\n\r\nmodule.exports.requireAuth = (req, res, next) => {\r\n    const token = req.cookies.jwt;\r\n    if(token) {\r\n        jwt.verify(token, process.env.TOKEN_SECRET, async (err, decodedToken) => {\r\n            if(err) {\r\n                console.log(err);\r\n                res.send(200).json('no token');\r\n            } else {\r\n                console.log(decodedToken.id);\r\n                next();\r\n            }\r\n        });\r\n    } else {\r\n        console.log('No token');\r\n    }\r\n}"],"file":"auth.middleware.js"}